#!/usr/bin/env perl
##
##  bin2c -- convert an binary file into a statically initialised
##           C array of characters
##
##  Copyright (c) Ralf S. Engelschall, All Rights Reserved.
##

use strict;
use warnings;
use autodie;

my ( $filein, $fileout, $name ) = @ARGV;

if ( @ARGV != 3 )
{
    die "Usage: $0 binary-file c-file buffer-name\n";
}

my $size = -s $filein;

open( my $in_fh, "<", $filein );
open( my $out_c, ">", "$fileout.c" );

print $out_c "/* $filein.c -- automatically generated by bin2c */\n";
print $out_c "\n";
print $out_c "int  ${name}_size   = " . $size . ";\n";
print $out_c "unsigned char ${name}_data[] = {\n";

my $i = 1;
my $c;
while ( read( $in_fh, $c, 1 ) )
{
    printf( $out_c "0x%02x", ord($c) );
    printf( $out_c "," ) if ( $i < $size );
    printf( $out_c "\n" ) if ( $i % 15 == 0 && $i < $size );
    ++$i;
}

print $out_c " };\n";
print $out_c "\n";
print $out_c "/*EOF*/\n";

close($in_fh);
close($out_c);
